Watch Ban
=========

Build and update DNS black lists from published domain lists for advertisement blocking and fat-finger protection.

## Warning

Watch Ban is intended to provide advertisement and domain blocking for well-behaved clients who opt-into the service.

* **Watch Ban is not a firewall**
* **Watch Ban is not a network security appliance**
* **Watch Ban does not provide any functionality to block traffic**

Watch Ban manages DNS policy-zone configurations. It is only effective _if clients use the managed DNS server_. Users and malicious actors can easily circumvent blocking policies by using another DNS server.

## Getting Started

* Ensure that the latest version of [NodeJS 4.x](https://nodejs.org/en/download/) is installed.
* Check out or unpack watch-ban into `/opt/watch-ban`.
* Copy the included [Upstart configuration](example/watch-ban.upstart) to `/etc/init/watch-ban.conf`.
* Fire it up `sudo start watch-ban`

### Additional Steps

* You will need to configure port HTTP/80 and.or HTTPS/443 listeners as your use-case requires. There is an [NGiNX site configuration](example/nginx/block) included in the example directory.
* You will need to configure a BIND9 server to load the configuration file generated by the `bind` renderer. Add the following to `/etc/bind/named.conf` (varies by platform):

  ```
  include "/opt/watch-ban/example/generated/block.conf";
  ```

  *NOTE* Most platforms configure Apparmor or SELinux rules for BIND. You may need to edit the `bind` renderer's `path` parameter to place the generated configuration file in `/etc/bind` or `/var/lib/bind` to allow the BIND process to read it. These paths may vary by platform.

* You will need to copy and modify the [`null` zone file](example/bind/db.null) included in the examples to `/etc/bind/db.null`. If the BIND configuration path for your platform is not `/etc/bind`, you will need to adjust `variables.file` in the example configuration for the `bind` render and place the `db.null` file appropriately.

## Configuration

### Source

An HTTP(S) endpoint that serves a new-line delimited list of domains

*Configuration*

* `interval`: Polling interval. A millisecond interval, 'hourly', or 'daily'
* `uri`: Resource URI

### Renderer

Configures a template, inputs, and service notifications for a managed file

*Configuration*

* `format`: Service-specific template. Currently supports `bind9`
* `path`: Path that rendered file will be written to
* `variables`: Object passed to template for additional configuration parameters
* `sources`: An array of names of sources whose entries will be passed to the template
* `notifies`: An array of names of services to reload then one or more sources changes

### Service

A service that needs to have reloads triggered when configuration files are updates

*Configuration*

* `reload`: The command to reload the service

The [example](example) directory contains a sample [configuration](example/config.json) file, and NGiNX and BIND9 configurations. The included [configuration](example/config.json) example should be sufficient to block many advertising, tracking, and compromised e-commerce sites.

For basic NGiNX and BIND9 configurations see
* The (NGiNX Beginners Guide)[http://nginx.org/en/docs/beginners_guide.html]
* The (DigitalOcean BIND9 Tutorial)[https://www.digitalocean.com/community/tutorials/how-to-configure-bind-as-a-private-network-dns-server-on-ubuntu-14-04]
